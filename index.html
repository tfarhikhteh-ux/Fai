<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAI | فرهیخته هوش مصنوعی</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu&family=Scheherazade+New&display=swap" rel="stylesheet">
    <style>
        /* همه استایل‌ها مانند قبل */
    </style>
</head>
<body>
    <!-- همه HTML مانند قبل -->

    <script>
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const question = document.getElementById('searchInput').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            
            if (!question) {
                showError('لطفاً سوال یا موضوع مورد نظر خود را وارد کنید');
                return;
            }
            
            if (!apiKey) {
                showError('لطفاً کلید DeepSeek API را وارد نمایید');
                return;
            }
            
            await getDeepSeekResponse(question, apiKey);
        });

        async function getDeepSeekResponse(question, apiKey) {
            showLoading();
            hideError();
            hideResponse();

            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'شما FAI (فرهیخته هوش مصنوعی) هستید - یک دستیار بسیار حرفه‌ای و فرهیخته. پاسخ‌های شما باید کامل، دقیق، با کلاس و به زبان فارسی باشد.'
                            },
                            {
                                role: 'user',
                                content: question
                            }
                        ],
                        max_tokens: 2048,
                        temperature: 0.7,
                        stream: false
                    })
                });

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.log('Error response:', errorText);
                    
                    if (response.status === 401) {
                        throw new Error('کلید API نامعتبر است');
                    } else if (response.status === 429) {
                        throw new Error('محدودیت تعداد درخواست. لطفاً کمی صبر کنید');
                    } else {
                        throw new Error(`خطای سرویس: ${response.status}`);
                    }
                }

                const data = await response.json();
                console.log('Success response:', data);
                
                if (!data.choices || !data.choices[0]) {
                    throw new Error('پاسخی از سرویس دریافت نشد');
                }
                
                const answer = data.choices[0].message.content;
                showResponse(question, answer);
                
            } catch (error) {
                console.log('Error:', error);
                showError(`خطا: ${error.message}`);
            } finally {
                hideLoading();
            }
        }

        // بقیه توابع مانند قبل...
    </script>
</body>
</html>
<input type="password" class="api-input" id="apiKey" 
       placeholder="کلید DeepSeek API خود را وارد کنید"
       value="sk-b2d21234650a44f8bdbd453c1774deac">
